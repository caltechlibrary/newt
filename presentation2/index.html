<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="R. S. Doiel, rsdoiel@caltech.edu" />
  <meta name="keywords" content="web service, micro
service, Postgres, PostgREST, Mustache" />
  <title>Newt, the second prototype</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Newt, the second prototype</h1>
  <p class="author">
R. S. Doiel, <a href="mailto:rsdoiel@caltech.edu"
class="email">rsdoiel@caltech.edu</a>
  </p>
  <p class="institute">
<p>Caltech Library, Digital Library Development</p>
  </p>
</div>
<div class="slide" id="TOC">

</div>
<div id="goal-of-the-second-prototype" class="slide section level1">
<h1>Goal of the second prototype</h1>
<p>Is Newt’s toolbox and “off the shelf” software enough to simplify our
applications?</p>
</div>
<div id="first-combine-the-right-abstractions"
class="slide section level1">
<h1>First, combine the right abstractions</h1>
<ul>
<li>Off the shelf web services</li>
<li>Aligning our expectations</li>
<li>Composing application using data pipelines</li>
</ul>
</div>
<div id="off-the-shelf" class="slide section level1">
<h1>Off the shelf</h1>
<ul>
<li><a href="https://postgresql.org">Postgres</a> + <a
href="https://postgrest.org">PostgREST</a>o =&gt; JSON data source</li>
<li>Newt Mustache a simple template engine =&gt; Transform JSON into web
pages</li>
<li>Newt new implementation of a data router ties it all together</li>
<li>YAML used to express routes, pipelines and data models</li>
</ul>
</div>
<div id="assembling-our-with-yaml" class="slide section level1">
<h1>Assembling our with YAML</h1>
<ul>
<li>Newt’s Second Prototype has a new YAML syntax
<ul>
<li>CITATION.cff for application metadata</li>
<li>GitHub YAML issue template syntax used to model data</li>
</ul></li>
<li>Newt generates SQL and templates from this YAML</li>
<li>Introducing Newt Mustache, a light weight template engine
<ul>
<li>Mapping your templates in the pipeline</li>
</ul></li>
</ul>
</div>
<div id="demo-time" class="slide section level1">
<h1>Demo time</h1>
<p>Let’s take a look at the demo …</p>
</div>
<div id="so-what-did-we-see" class="slide section level1">
<h1>So what did we see?</h1>
<ol style="list-style-type: decimal">
<li>static site derived from CSV data file
<ul>
<li>CSV file holds our sighting list</li>
<li>Mustache templates can render our content</li>
</ul></li>
<li>dynamic, SQL and browser JavaScript
<ul>
<li>(YAML and code generation)</li>
<li>(bird sighting list held in SQL database)</li>
<li>(JavaScript browser side assembles web site)</li>
</ul></li>
<li>dynamic, SQL and no browser JavaScript
<ul>
<li>(bird sighting list held in SQL database)</li>
<li>(Mustache templates transform content)</li>
<li>(Data routing provides the website)</li>
</ul></li>
</ol>
<p>What were the trade-offs?</p>
</div>
<div id="a-static-bird-static-site-mustache-templates"
class="slide section level1">
<h1><a
href="https://github.com/caltechlibrary/newt/tree/main/demos/birds1">A
static bird</a>, static site, Mustache templates</h1>
<p>CSV file, Mustache, 2 directories, 4 files, <strong>?? total line
count</strong>, static site</p>
<table>
<thead>
<tr class="header">
<th align="left">Lines</th>
<th align="left">Files</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">??</td>
<td align="left">README.md</td>
</tr>
<tr class="even">
<td align="left">?</td>
<td align="left">birds.csv &lt;– this is the seed data used in all the
implementations</td>
</tr>
<tr class="odd">
<td align="left">?</td>
<td align="left">page.tmpl</td>
</tr>
<tr class="even">
<td align="left">??</td>
<td align="left">htdocs/index.html</td>
</tr>
</tbody>
</table>
</div>
<div
id="a-dynamic-site-requiring-browser-side-js-dynamic-site-browser-javascript"
class="slide section level1">
<h1><a
href="https://github.com/caltechlibrary/newt/tree/main/demos/birds2">A
dynamic site requiring browser side JS</a>, dynamic site, browser
JavaScript</h1>
<p>SQL (Postgres + PostgREST), Browser JavaScript, 2 directories, 9
files, <strong>??? total line count</strong>, dynamic site</p>
<table>
<thead>
<tr class="header">
<th align="left">Lines</th>
<th align="left">Files</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">??</td>
<td align="left">README.md</td>
</tr>
<tr class="even">
<td align="left">?</td>
<td align="left">birds.csv &lt;– from birds1, loaded into SQL
database</td>
</tr>
<tr class="odd">
<td align="left">??</td>
<td align="left">birds.yaml &lt;— use to generate the models only</td>
</tr>
<tr class="even">
<td align="left">??</td>
<td align="left">setup.sql &lt;– code generation, newtgen</td>
</tr>
<tr class="odd">
<td align="left">??</td>
<td align="left">models.sql &lt;– code generation, newtgen</td>
</tr>
<tr class="even">
<td align="left">??</td>
<td align="left">models_test.sql &lt;– generated code, newtgen</td>
</tr>
<tr class="odd">
<td align="left">?</td>
<td align="left">postgrest.conf &lt;– generated code, newtgen</td>
</tr>
<tr class="even">
<td align="left">??</td>
<td align="left">htdocs/index.html &lt;– hand coded</td>
</tr>
<tr class="odd">
<td align="left">??</td>
<td align="left">htdocs/sightings.js &lt;– hand coded</td>
</tr>
</tbody>
</table>
</div>
<div id="birds-version-3-dynamic-site-no-browser-javascript"
class="slide section level1">
<h1><a
href="https://github.com/caltechlibrary/newt/tree/main/demos/birds3">birds
version 3</a>, dynamic site, no browser JavaScript</h1>
<p>SQL (Postgres + PostgREST), Newt Mustache, Newt, 1 directory, 9
files, <strong>225 total line count</strong>, dynamic site</p>
<table>
<thead>
<tr class="header">
<th align="left">Lines</th>
<th align="left">Files</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">43</td>
<td align="left">README.md</td>
</tr>
<tr class="even">
<td align="left">?</td>
<td align="left">birds.csv &lt;– from birds1, loaded into SQL
database</td>
</tr>
<tr class="odd">
<td align="left">??</td>
<td align="left">birds.yaml &lt;— Newt models and routing</td>
</tr>
<tr class="even">
<td align="left">34</td>
<td align="left">setup.sql &lt;– code generation, newtgen</td>
</tr>
<tr class="odd">
<td align="left">60</td>
<td align="left">models.sql &lt;– code generation, newtgen</td>
</tr>
<tr class="even">
<td align="left">15</td>
<td align="left">models_test.sql &lt;– code generation, newtgen</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">postgrest.conf &lt;– code generation, newtgen</td>
</tr>
<tr class="even">
<td align="left">??</td>
<td align="left">birds_tmpl.yaml &lt;– hand coded, maps our templates to
request in Newt Mustache</td>
</tr>
<tr class="odd">
<td align="left">36</td>
<td align="left">page.tmpl</td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="left">post_result.tmpl</td>
</tr>
</tbody>
</table>
</div>
<div id="insights-from-experiment" class="slide section level1">
<h1>Insights from experiment</h1>
<ul>
<li><p>A few “Off the shelf” web services can make application
construction easier</p></li>
<li><p>A few “Off the shelf” can also shrink what we maintain</p></li>
<li><p>SQL turns some people off, so let’s use a code generator</p></li>
<li><p>Modify SQL, even when you know it, is often easier than typing it
into an empty file</p></li>
<li><p>Mustache templates are simple to learn, see the <a
href="https://mustache.github.io">Mustache Web site</a></p></li>
<li><p>Mustache templates are easy to debug either from Newt Mustache or
the Mustache cli</p></li>
<li><p>Newt really caters to the newly vintage of HTML5 and progressive
enhancement</p></li>
<li><p>I encountered an unexpected result …</p></li>
</ul>
</div>
<div id="an-unexpected-result" class="slide section level1">
<h1>An unexpected result</h1>
<ul>
<li>Running more web services has it’s own cognitive price, are you OK
with that?</li>
<li>Containers to run many web services just adds to complexity</li>
<li>Thinking about an echo system of applications that can use the same
web services is promising
<ul>
<li>Can we safely aggregate our Newt YAML files?</li>
</ul></li>
<li>The web services need to provide a “developer” model for
debugging</li>
<li>Writing tests with <a href="https://curl.se/">curl</a> gets tedious,
newtgen needs to generate this code</li>
<li>Newt can be used as a large static site generator, ex. feeds v2</li>
</ul>
</div>
<div id="newt-has-weaknesses" class="slide section level1">
<h1>Newt has weaknesses</h1>
<ul>
<li>Newt is <strong>an experimental working prototype</strong> (February
2024)</li>
<li>You really want to minimize your pipelines to one to three
stages</li>
<li>An app with too many routes is hard to maintain, avoid doing
that</li>
<li>While Newt uses YAML, you need to learn the YAML syntax for three
Newt tools
<ul>
<li>Newt data router and code generator share one syntax</li>
<li>Can Newt Mustache and pdbundler share one syntax?</li>
<li>Can the code generator produce the Newt Mustache YAML?</li>
</ul></li>
<li>Newt doesn’t support file uploads
<ul>
<li>That would be nice to broaden Newt’s application domain</li>
</ul></li>
</ul>
</div>
<div id="newt-stack-has-strengths" class="slide section level1">
<h1>Newt stack has strengths</h1>
<blockquote>
<p>A very mature foundation</p>
</blockquote>
<ul>
<li>20th Century tech
<ul>
<li>SQL (1974), HTTP (1991), HTML (1993), Postgres (1996)</li>
</ul></li>
<li>21st Century tech
<ul>
<li>JSON (2001), YAML (2001), Pandoc (2006), Mustache templates (2009),
PostgREST (2014)</li>
</ul></li>
</ul>
</div>
<div id="next-steps-for-newt-project" class="slide section level1">
<h1>Next steps for Newt Project?</h1>
<ol style="list-style-type: decimal">
<li>Consider allowing the Newt data router to access non-localhost
resources</li>
<li>Continue build public facing applications this Spring through Winter
(2024)</li>
<li>Documentation and tutorials</li>
</ol>
</div>
<div id="newts-someday-maybe" class="slide section level1">
<h1>Newt’s someday, maybe …</h1>
<ul>
<li>Integrating S3 protocol support would allow file uploads to be
addressed</li>
<li>Explore light weight options to use SQLite 3 databases</li>
<li>Explore a web service that would enable non-linear conditional
pipelines</li>
<li>Visually programming to generate all the Newt YAML files</li>
<li>A Newt community to share YAML, SQL, templates and web
components</li>
</ul>
</div>
<div id="related-resources" class="slide section level1">
<h1>Related resources</h1>
<ul>
<li>Newt <a href="https://github.com/caltechlibrary/newt"
class="uri">https://github.com/caltechlibrary/newt</a></li>
<li>Go 1.22 and it’s pattern language for HTTP handlers, see <a
href="https://pkg.go.dev/net/http#hdr-Patterns"
class="uri">https://pkg.go.dev/net/http#hdr-Patterns</a></li>
<li>Postgres <a href="https://postgres.org"
class="uri">https://postgres.org</a> + PostgREST <a
href="https://postgrest.org" class="uri">https://postgrest.org</a>
<ul>
<li>PostgREST Community Tutorials <a
href="https://postgrest.org/en/stable/ecosystem.html"
class="uri">https://postgrest.org/en/stable/ecosystem.html</a></li>
</ul></li>
<li>Compiling Pandoc or PostgREST requires Haskell
<ul>
<li>Install Haskell GHCup <a href="https://www.haskell.org/ghcup/"
class="uri">https://www.haskell.org/ghcup/</a></li>
<li><a
href="https://rsdoiel.github.io/blog/2023/07/05/quick-recipe-compiling-PostgREST-M1.html">Quick
recipe, Compile PostgREST (M1)</a></li>
<li><a
href="https://rsdoiel.github.io/blog/2023/07/05/quick-recipe-compiling-Pandoc-M1.html">Quick
recipe, Compiling Pandoc (M1)</a></li>
</ul></li>
</ul>
</div>
<div id="thank-you" class="slide section level1">
<h1>Thank you!</h1>
<ul>
<li>This Presentation <a
href="https://caltechlibrary.github.io/newt/presentation2/"
class="uri">https://caltechlibrary.github.io/newt/presentation2/</a></li>
<li>Project: <a href="https://github.com/caltechlibrary/newt"
class="uri">https://github.com/caltechlibrary/newt</a></li>
<li>Email: rsdoiel@caltech.edu</li>
</ul>
</div>
</body>
</html>
