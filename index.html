<!DOCTYPE html>
<html>
<head>
    <title>Newt -- a new take on the webstack</title>
    <link rel="stylesheet" href="https://caltechlibrary.github.io/css/site.css">
</head>
<body>
<header>
<a href="https://library.caltech.edu"><img src="https://caltechlibrary.github.io/assets/liblogo.gif" alt="Caltech Library logo"></a>
</header>
<nav>
<ul>
	<li><a href="/">Home</a></li>
	<li><a href="./">README</a></li>
	<li><a href="user-manual.html">User Manual</a></li>
	<li><a href="LICENSE">LICENSE</a></li>
	<li><a href="INSTALL.html">INSTALL</a></li>
	<li><a href="about.html">About</a></li>
	<li><a href="https://github.com/rsdoiel/newt">GitHub</a></li>
</ul>
</nav>

<section>
<h1 id="newt-my-new-take-on-the-web-stack">Newt, my new take on the web
stack</h1>
<p>Newt is two things. Newt is short for “new take”. Newt is also an
experimental web server for working with off the shelf <a
href="https://en.wikipedia.org/wiki/Microservices">microservices</a>.
The specific microservices Newt is intend to help explore are <a
href="https://postgresql.org">Postgres</a>, <a
href="https://postgrest.org">PostgREST</a>, <a
href="https://pandoc.org">Pandoc server</a>. The Newt program can be
thought of as both a data router (i.e. make requests to PostgREST and
Pandoc) and as a light weight static file server. It runs on localhost
only. It would normally would be behind a front-end web server like
NginX or Apache 2.</p>
<h2 id="motivation">Motivation</h2>
<p>My belief is that many web services used by Archives, Libraries and
Museums can benefit from a simplifying back-end. If the back-end is
“easy” then the limited developer resources can be focused on the
front-end. <strong>An improved front-end offers opportunities to provide
a more humane user experience for staff and patrons.</strong></p>
<h2 id="a-basic-newt-approach">A basic Newt approach</h2>
<p>From front-end to back-end</p>
<ul>
<li>A front end web server (e.g. Apache 2, NginX) can provide access
control where appropriate (e.g. Single Signon with OAuth2 or
Shibboleth)</li>
<li>Newt is a data router. It uses simple a CSV file for defining
routes. It can also provide static files</li>
<li>Postgres+PostgREST provides a JSON data API (programming is in
SQL)</li>
<li>Pandoc server (provides a templating engine to transform data
sources)</li>
</ul>
<p>All these can be treated as “off the shelf”. Aside from configuration
they run as traditional services on POSIX systems. Your application is
primarily developed using SQL (defining the behavior and content via
PostgREST), Pandoc templates are used to turn JSON into HTML (or other
desired formats). Any additional static content (e.g. HTML pages, CSS,
JavaScript files) can also be made available view Newt.</p>
<h2 id="beyond-postgrespostgrest">Beyond Postgres+PostgREST</h2>
<p>Newt can talk to any data API as long as it returns its content in
JSON. Thie means Newt can also route content to Solr or Elasticsearch
before taking the results and sending them through Pandoc. This more
elaborate setup would look like this from front-end to back-end.</p>
<ul>
<li>A front end web server (e.g. Apache 2, NginX) integrated providing
access control where appropriate (e.g. Single Signon with OAuth2 or
Shibboleth)</li>
<li>Newt URL router (uses a CSV file for defining routes)</li>
<li>Search Engine (e.g. Solr, Opensearch)</li>
<li>Postgres+PostgREST (provides a data source API, is programmed in
SQL)</li>
<li>Pandoc server (provides a templating engine to transform data
sources)</li>
</ul>
<p>Once again the routes define where the requests go (e.g. Solr or
PostgREST). Pandoc templates transform the JSON responses into HTML
result pages.</p>
<p>The main additional work beyond the initial scenario is creating the
Pandoc templates you need to display the results from querying Solr.</p>
<h2 id="explore-newt-and-friends">Explore Newt and friends</h2>
<h3 id="step-1-pandoc">Step 1, Pandoc</h3>
<p>Pandoc can be throught of as a powerful template engine. It is
familair to many people who building “static” websites. It is known for
being able to convert many structured text formats to another. The <a
href="birds1/">birds 1 demo</a>, a simple bird listing site, is built
using Pandoc with content in both Markdown and a list of birds sighted
in a CSV file. Pandoc does the stitching rendering the content to
HTML.</p>
<p>Birds 1 Demo files</p>
<ul>
<li><a href="birds1/README.html">README.md</a></li>
<li><a href="birds1/birds.csv">birds.csv</a></li>
<li><a href="birds1/birds.html">birds.md</a></li>
<li><a href="birds1/build.sh">build.sh</a></li>
<li><a href="birds1/htdocs">htdocs</a>
<ul>
<li><a href="birds1/htdocs/index.html">index.html</a></li>
</ul></li>
<li><a href="birds1/page.tmpl">page.tmpl</a></li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Pandoc is widely known</td>
<td style="text-align: left;">Updates require accessing birds.csv</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pandoc is easily scripted</td>
<td style="text-align: left;">A static web server is needed</td>
</tr>
</tbody>
</table>
<h3 id="step-2-postgres-postgrest">Step 2, Postgres + PostgREST</h3>
<p>Postgres and PostgREST can be combined to provide a dynamic solution
for our <a href="birds2/">birds 2 demo</a> website. In <a
href="birds2/">birds 2 demo</a> PostgREST runs on localhost and we use
another web server to presents the static files. The difference from
birds 1 demo is that our list of birds is held in the Postgres database
and provided via a JSON API call using JavaScript.</p>
<p>The back-end is primarily the SQL code setting things up. The
font-end is more complex as JavaScript is required in the browser to
assemble pages results from our JSON data API.</p>
<p>The files for birds 2 demo are</p>
<ul>
<li><a href="birds2/README.html">README.md</a></li>
<li><a href="birds2/birds.csv">birds.csv</a></li>
<li><a href="birds2/htdocs/">htdocs</a>
<ul>
<li><a href="birds2/htdocs/index.html">index.html</a></li>
<li><a href="birds2/htdocs/sightings.js">sightings.js</a></li>
</ul></li>
<li><a href="birds2/postgrest.conf">postgrest.conf</a></li>
<li><a href="birds2/setup.sql">setup.sql</a></li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Simple backend, just SQL code</td>
<td style="text-align: left;">JavaScript in the browser is complex</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">You need a static file server</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">You need to know some SQL</td>
</tr>
</tbody>
</table>
<h2 id="step-3-let-newt-assemble-the-pages">Step 3, let Newt assemble
the pages</h2>
<p>Managing page assembly browser side is a chore. We can skip the
complex JavaScript browser side if we let Newt to route data to
PostgREST or a search engine then run the results through Pandoc. The <a
href="birds3/">birds 3</a> demo shows how this works. With just SQL and
Pandoc templates we can build a web application.</p>
<p>The files for birds 3 demo are</p>
<ul>
<li><a href="birds3/README.html">README.md</a></li>
<li><a href="birds3/birds-routes.csv">birds-routes.csv</a></li>
<li><a href="birds3/birds.csv">birds.csv</a></li>
<li><a href="birds3/birds.yaml">birds.yaml</a></li>
<li><a href="birds3/htdocs/">htdocs</a>
<ul>
<li><a href="birds3/htdocs/index.html">index.html</a></li>
</ul></li>
<li><a href="birds3/page.tmpl">page.tmpl</a></li>
<li><a href="birds3/postgrest.conf">postgrest.conf</a></li>
<li><a href="birds3/setup.sql">setup.sql</a></li>
</ul>
<p>This is very similar to both demo 1 and 2. Missing is build.sh from
demo 1. We don’t need it since we’re running Pandoc as a web service.
There is an added configuration file for Newt. The Pandoc template
script like in demo 1 and unlike demo 2 there is no sightings.js file to
send to the web browser. Also Newt provides our static file service so
indevelopment we don’t need Apache 2 or NginX.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Simple backend, just SQL code</td>
<td style="text-align: left;">Like demo 2 you need to know some SQL</td>
</tr>
<tr class="even">
<td style="text-align: left;">No JavaScript required browser side</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Newt provides the static web server</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h2 id="more-about-newt">More about Newt</h2>
<p>Configuring Newt can be done in a YAML file or through the shell’s
enviroment. A minimum setup requires a pointer to the CSV file container
your route definitions. The environment variable needed is
<code>NEWT_ROUTES</code> in the YAML file the attribute is
<code>newt_routes</code>. If you also wish to have static file service
support then you would set <code>NEWT_HTDOCS</code> in the environment
or <code>newt_htdocs</code> in the YAML configuration file.</p>
<ul>
<li><a
href="building%20with%20postgres-postgrest-pandoc-and-newt.html">Building
web Postgres, PostgREST, Pandoc and Newt</a></li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>In all our demos we’ve devided the tasks through a series of flexible
microservices.</p>
<dl>
<dt>Postgres</dt>
<dd>
provides data storage, back-end configuration and data services
</dd>
<dt>PostgREST</dt>
<dd>
Turns a Postgres database into a DATA API
</dd>
<dt>Pandoc</dt>
<dd>
Run in server mode is a powerful template engine
</dd>
<dt>Newt</dt>
<dd>
Is a data router and stastic file server. Newt knows how to talk to a
data source like PostgREST or Solr and then run the results through
Pandoc.
</dd>
</dl>
<p>The “coding” of the back-end is reduced to SQL and Pandoc templates.
The front-end can be as complex as you like given the full capabilities
of your web browser to handle HTML, CSS and JavaScript.</p>
</section>

<footer>
<span><h1><A href="http://caltech.edu">Caltech</a></h1></span>
<span>&copy; 2023 <a href="https://www.library.caltech.edu/copyright">Caltech library</a></span>
<address>1200 E California Blvd, Mail Code 1-32, Pasadena, CA 91125-3200</address> 
<span>Phone: <a href="tel:+1-626-395-3405">(626)395-3405</a></span>
<span><a href="mailto:library@caltech.edu">Email Us</a></span>
<a class="cl-hide" href="sitemap.xml">Site Map</a>
</footer>
</body>
</html>
