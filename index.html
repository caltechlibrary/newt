<!DOCTYPE html>
<html>
<head>
    <title>Newt -- a new take on the webstack</title>
    <link rel="stylesheet" href="https://caltechlibrary.github.io/css/site.css">
</head>
<body>
<header>
<a href="https://library.caltech.edu"><img src="https://caltechlibrary.github.io/assets/liblogo.gif" alt="Caltech Library logo"></a>
</header>
<nav>
<ul>
	<li><a href="/">Home</a></li>
	<li><a href="./">README</a></li>
	<li><a href="user-manual.html">User Manual</a></li>
	<li><a href="LICENSE">LICENSE</a></li>
	<li><a href="INSTALL.html">INSTALL</a></li>
	<li><a href="about.html">About</a></li>
	<li><a href="https://github.com/rsdoiel/newt">GitHub</a></li>
</ul>
</nav>

<section>
<h1 id="newt-a-new-take-of-the-web-stack">Newt, a new take of the web
stack</h1>
<p>Newt is two things. Newt is short for “new take”. Newt is also an
experimental web service for working with off the shelf <a
href="https://en.wikipedia.org/wiki/Microservices">microservices</a>.
The specific microservices Newt is intend to help explore are <a
href="https://postgresql.org">Postgres</a>, <a
href="https://postgrest.org">PostgREST</a>, <a
href="https://pandoc.org">Pandoc server</a>. The Newt program can be
thought of as both a data router (i.e. make requests to PostgREST and
Pandoc) an a light weight static file server. It only runs on localhost
so normally would be behind a front-end web server like NginX or Apache
2.</p>
<h2 id="motivation">Motivation</h2>
<p>My belief is that many web services used by Archives, Libraries and
Museums can benefit from a simplier back-end. If the back-end is “easy”
then the limited developer resources can be focused on the front-end. An
improved front-end offers opportunities to provide a more humane user
experience for staff and patrons.</p>
<h2 id="a-basic-newt-approach">A basic Newt approach</h2>
<p>From back to front</p>
<ul>
<li>Postgres+PostgREST (provides a data API, it is programmed in
SQL)</li>
<li>Pandoc server (provides a templating engine to transform data
sources)</li>
<li>Newt is a URL router (uses a CSV file for defining routes) and
provides static file services</li>
<li>A front end web server (e.g. Apache 2, NginX) can provide access
control where appropriate (e.g. Single Signon with OAuth2 or
Shibboleth)</li>
</ul>
<p>All these can be treated as “off the shelf”. Aside from configuration
they run as traditional services on POSIX systems. Your application is
primarily developed using SQL (defining the behavior our PostgREST),
Pandoc templates used to turn JSON into HTML. Any additional static
content (e.g. web pages, CSS, JavaScript for the web browser) may also
be provided by Newt.</p>
<h2 id="a-more-complex-stack">A more complex stack</h2>
<p>Similar to the above example you could include full text search via
Solr, Elasticsearch or Opensearch. In that case the stack from back to
front would look like.</p>
<ul>
<li>Postgres+PostgREST (provides a data source API, is programmed in
SQL)</li>
<li>Search Engine (e.g. Solr, Opensearch)</li>
<li>Pandoc server (provides a templating engine to transform data
sources)</li>
<li>Newt URL router (uses a CSV file for defining routes)</li>
<li>A front end web server (e.g. Apache 2, NginX) integrated providing
access control where appropriate (e.g. Single Signon with OAuth2 or
Shibboleth)</li>
</ul>
<p>The routes your define for Newt would select the appropriate data
source.</p>
<p>The increase in complexity would be the additional routes you define
in our CSV file as well as any additional templating needed to render
the search engine results via Pandoc.</p>
<h2 id="explore-newt-and-friends">Explore Newt and friends</h2>
<h3 id="step-1-pandoc">Step 1, Pandoc</h3>
<p>Pandoc a powerful template engine often assoicated with building
static sites. It can run as a microservice (more on that below). The <a
href="birds1/">birds 1</a> demo shows a simple bird listing site built
from static content in Markdown, a list of birds in a CSV file and
stitched together using Pandoc and Pandoc templates.</p>
<h3 id="step-2-postgres-postgrest">Step 2, Postgres + PostgREST</h3>
<p>The combination of Postgres and PostgREST provides a rich data API
defined from the data models in Postgres. In <a href="birds2/">birds
2</a> demo PostgREST runs on localhost and we use a localhost web server
to present the static files. The differents is that our list of birds is
held in the Postgres database and provides via a JSON API call using
JavaScript.</p>
<ul>
<li><a href="building-with-postgres-postgrest.html">Building with
Postgres and PostgREST</a> discusses the approach taken to create the <a
href="birds2/">birds</a> demo</li>
<li>Extas for setting up a developer environment
<ul>
<li><a href="setup-birds.bash">setup-birds.bash</a>, a bash script that
generates the contents of demo’s running code</li>
<li><a href="multipass-basics.html">Multipass basics</a>, multipass runs
Ubuntu VM which can be used to run the demo</li>
<li><a href="newt-init.yaml">newt-init.yaml</a> provides the
configuration for a multipass based VM to run the demo</li>
<li><a
href="setup-developer-account.bash">setup-developer-account.bash</a> is
a bash script that displays Postgres commands for setting up a super
user account for development.</li>
</ul></li>
</ul>
<h2 id="step-3-what-weve-learned-togher-with-newt">Step 3, what we’ve
learned togher with Newt</h2>
<p>Managing page assembly browser side is a chore. We can skip the
complex JavaScript for that and use Newt to route data from PostgREST or
a search engine through Pandoc before returning it to the web browser.
The <a href="birds3/">birds 3</a> demo shows how this works. With just
SQL and Pandoc templates we can build a web application.</p>
<p>Configuring Newt can be done in a YAML file or through the shell’s
enviroment. A minimum setup requires a pointer to the CSV file container
your route definitions. The environment variable needed is
<code>NEWT_ROUTES</code> in the YAML file the attribute is
<code>newt_routes</code>. If you also wish to have static file service
support then you would set <code>NEWT_HTDOCS</code> in the environment
or <code>newt_htdocs</code> in the YAML configuration file.</p>
<ul>
<li><a
href="building%20with%20postgres-postgrest-pandoc-and-newt.html">Building
web Postgres, PostgREST, Pandoc and Newt</a></li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>In all our demos we’ve devided the tasks through a series of flexible
microservices.</p>
<dl>
<dt>Postgres</dt>
<dd>
provides data storage, back-end configuration and data services
</dd>
<dt>PostgREST</dt>
<dd>
Turns a Postgres database into a DATA API
</dd>
<dt>Pandoc</dt>
<dd>
Run in server mode is a powerful template engine
</dd>
<dt>Newt</dt>
<dd>
Is a data router and stastic file server. Newt knows how to talk to a
data source like PostgREST or Solr and then run the results through
Pandoc.
</dd>
</dl>
<p>The “coding” of the back-end is reduced to SQL and Pandoc templates.
The front-end can be as complex as you like given the full capabilities
of your web browser to handle HTML, CSS and JavaScript.</p>
</section>

<footer>
<span><h1><A href="http://caltech.edu">Caltech</a></h1></span>
<span>&copy; 2023 <a href="https://www.library.caltech.edu/copyright">Caltech library</a></span>
<address>1200 E California Blvd, Mail Code 1-32, Pasadena, CA 91125-3200</address> 
<span>Phone: <a href="tel:+1-626-395-3405">(626)395-3405</a></span>
<span><a href="mailto:library@caltech.edu">Email Us</a></span>
<a class="cl-hide" href="sitemap.xml">Site Map</a>
</footer>
</body>
</html>
