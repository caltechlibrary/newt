<!DOCTYPE html>
<html>
<head>
    <title>Newt -- a new take on the webstack</title>
    <link rel="stylesheet" href="https://caltechlibrary.github.io/css/site.css">
</head>
<body>
<header>
<a href="https://library.caltech.edu"><img src="https://caltechlibrary.github.io/assets/liblogo.gif" alt="Caltech Library logo"></a>
</header>
<nav>
<ul>
	<li><a href="/">Home</a></li>
	<li><a href="./">README</a></li>
	<li><a href="user-manual.html">User Manual</a></li>
	<li><a href="LICENSE">LICENSE</a></li>
	<li><a href="INSTALL.html">INSTALL</a></li>
	<li><a href="about.html">About</a></li>
	<li><a href="https://github.com/rsdoiel/newt">GitHub</a></li>
</ul>
</nav>

<section>
<h1 id="newt-my-new-take-on-the-web-stack">Newt, my new take on the web
stack</h1>
<p>Newt is two things. It is short a “new take” on building web
applications. It is also an experimental microservice for working with
other off the shelf <a
href="https://en.wikipedia.org/wiki/Microservices">microservices</a>.</p>
<p>Currently I am exploring using Newt to integrate <a
href="https://postgresql.org">Postgres</a>, <a
href="https://postgrest.org">PostgREST</a> and <a
href="https://pandoc.org">Pandoc</a>.</p>
<p>The Newt application can be thought of as both a data router and a
light weight static file server.</p>
<p>Newt can route a request to a JSON data API and then optional send
that result through Pandoc for further processing. Newt runs as a
localhost service only. To use in a production setting it would site
behind a traditional web server like Apache 2 or NginX.</p>
<h2 id="motivation">Motivation</h2>
<p>My belief is that many web services used by Archives, Libraries and
Museums can benefit from a simplified and consistent back-end. If the
back-end is “easy” then the limited developer resources can be focused
on the front-end. <strong>An improved front-end offers opportunities to
provide a more humane user experience for staff and
patrons.</strong></p>
<h2 id="newts-approach">Newt’s approach</h2>
<p>From front-end to back-end</p>
<ul>
<li>A front end web server (e.g. Apache 2, NginX) can provide access
control where appropriate (e.g. Single Sign on with OAuth2 or
Shibboleth)</li>
<li>Newt provides static file services but more importantly serves as a
data router. I can map a request to a JSON data API, take those results
then send them through Pandoc for transformation.</li>
<li>Postgres+PostgREST is an example of a JSON data API</li>
<li>Pandoc server provides a templating engine to transform data
sources</li>
</ul>
<p>All these can be treated as “off the shelf”. Aside from configuration
they can run as traditional services on most POSIX systems. Your
application is implemented using SQL. It is enhanced by using Pandoc
templates used to turn JSON into HTML (or other desired formats).</p>
<h2 id="beyond-postgrespostgrest">Beyond Postgres+PostgREST</h2>
<p>Newt can talk to any JSON data API as long as it returns its content
in JSON. This means Newt can also route content to Solr or Elasticsearch
before taking the results and sending them through Pandoc. This more
elaborate setup would look like this from front-end to back-end.</p>
<ul>
<li>A front end web server (e.g. Apache 2, NginX) integrated providing
access control where appropriate (e.g. Single Sign on with OAuth2 or
Shibboleth)</li>
<li>Newt URL router (uses a CSV file for defining routes)</li>
<li>Search Engine (e.g. Solr, Opensearch)</li>
<li>Postgres+PostgREST (provides a data source API, is programmed in
SQL)</li>
<li>Pandoc server (provides a templating engine to transform data
sources)</li>
</ul>
<p>Once again the routes define where the requests go (e.g. Solr or
PostgREST). Pandoc templates transform the JSON responses into HTML
result pages.</p>
<p>The main additional work beyond the initial scenario is creating the
Pandoc templates you need to display the results from querying Solr or
Elasticsearch.</p>
<h2 id="exploring-newts-friends">Exploring Newt’s friends</h2>
<ul>
<li>Pandoc</li>
<li>Postgres and PostgREST</li>
</ul>
<h3 id="pandoc">Pandoc</h3>
<p>Pandoc can be thought of as a powerful template engine. It is
familiar to many people who building “static” websites. It is known for
being able to convert many structured text formats from one to another.
The <a href="birds1/">birds 1 demo</a>, a simple bird listing site, is
built using Pandoc with content written Markdown and a list of birds
sighted maintained in a CSV file. Pandoc is used to render both into the
HTML needed to display the website.</p>
<h3 id="birds-1-demo-files">Birds 1 Demo files</h3>
<p>(see <a
href="https://github.com/caltechlibrary/newt/tree/main/birds1"
class="uri">https://github.com/caltechlibrary/newt/tree/main/birds1</a>)</p>
<ul>
<li>README.md, demo read me</li>
<li>birds.csv, our list of bird sightings</li>
<li>birds.md, additional text descriptions</li>
<li>build.sh, a shell script that uses Pandoc to render site</li>
<li>htdocs, the website document directory
<ul>
<li>index.html</li>
</ul></li>
<li>page.tmpl, the Pandoc page template</li>
</ul>
<h3 id="birds-1-demo">Birds 1 Demo</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Pandoc is widely known</td>
<td style="text-align: left;">Updates require changing birds.csv</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pandoc is easily scripted</td>
<td style="text-align: left;">A static web server is needed</td>
</tr>
</tbody>
</table>
<h3 id="postgres-postgrest">Postgres + PostgREST</h3>
<p>Postgres and PostgREST can be combined to provide a dynamic data
source for our <a href="birds2/">birds 2 demo</a> website. In <a
href="birds2/">birds 2 demo</a> PostgREST runs on localhost and we use
another web server to presents the static files. The difference from
birds 1 demo is that our list of birds is held in the Postgres database
and provided via a JSON API call using JavaScript in the web
browser.</p>
<p>The back-end is primarily written using SQL. This includes setting up
access by PostgREST. The font-end is more complex as JavaScript is
required in the browser to assemble pages results from our JSON data
API.</p>
<h4 id="birds-2-demo">Birds 2 demo</h4>
<p>(see <a
href="https://github.com/caltechlibrary/newt/tree/main/birds2"
class="uri">https://github.com/caltechlibrary/newt/tree/main/birds2</a>)</p>
<ul>
<li>README.md, demo read me</li>
<li>birds.csv, our sightings data, loads into SQL database</li>
<li>htdocs, the website document directory
<ul>
<li>index.html</li>
<li>sightings.js, JavaScript support is required in the web browser to
render the page and handle updates</li>
</ul></li>
<li>postgrest.conf, configuration for PostgREST</li>
<li>setup.sql, SQL setting up data models and JSON data API</li>
</ul>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Simple back-end, just SQL code</td>
<td style="text-align: left;">JavaScript in the browser is complex</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">You need a static file server</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">You need to know some SQL</td>
</tr>
</tbody>
</table>
<h3 id="assembling-responses-with-newt">Assembling responses with
Newt</h3>
<p>(see <a
href="https://github.com/caltechlibrary/newt/tree/main/birds3"
class="uri">https://github.com/caltechlibrary/newt/tree/main/birds3</a>)</p>
<p>Managing page assembly browser side is a chore. We can skip the
complex JavaScript browser side if we let Newt do the routing of
requests to PostgREST and then sending those results through Pandoc. The
birds 3 demo shows how this works. With just SQL and Pandoc templates we
can build a web application.</p>
<h4 id="birds-3-demo">Birds 3 Demo</h4>
<ul>
<li>README.md, demo read me</li>
<li>birds-routes.csv, CSV holding data routing instructions</li>
<li>birds.csv, CSV holding data to be loaded via SQL</li>
<li>birds.yaml, configuration for Newt</li>
<li>htdocs
<ul>
<li>index.html, static homepage, links feature pages</li>
<li>add-bird.html, a webform for adding bird sighthings</li>
<li>about.html, static page, credits</li>
</ul></li>
<li>page.tmpl, Pandoc template for listing birds</li>
<li>postgrest.conf, configurtion for PostgREST</li>
<li>setup.sql, SQL setting of data models and JSON data API</li>
</ul>
<p>This is very similar to both demo 1 and 2. Missing is build.sh from
demo 1. We don’t need it since we’re running Pandoc as a web service.
There is an added configuration file for Newt. The Pandoc template
script like in demo 1 and unlike demo 2 there is no sightings.js file to
send to the web browser. Also Newt provides our static file service so
when developing we don’t need Apache 2 or NginX.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Pros</th>
<th style="text-align: left;">Cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Simple back-end, just SQL code</td>
<td style="text-align: left;">Like demo 2 you need to know some SQL</td>
</tr>
<tr class="even">
<td style="text-align: left;">No JavaScript required browser side</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Newt provides the static web server</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h2 id="more-about-newt">More about Newt</h2>
<p>Configuring Newt can be done in a YAML file or through the shell’s
environment. A minimum setup requires a pointer to the CSV file
container your route definitions. The environment variable needed is
<code>NEWT_ROUTES</code> in the YAML file the attribute is
<code>newt_routes</code>. If you also wish to have static file service
support then you would set <code>NEWT_HTDOCS</code> in the environment
or <code>newt_htdocs</code> in the YAML configuration file.</p>
<ul>
<li><a
href="building%20with%20postgres-postgrest-pandoc-and-newt.html">Building
web Postgres, PostgREST, Pandoc and Newt</a></li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>In all our demos we’ve divided the tasks through a series of flexible
microservices.</p>
<dl>
<dt>Postgres</dt>
<dd>
provides data storage, back-end configuration and data services
</dd>
<dt>PostgREST</dt>
<dd>
Turns a Postgres database into a DATA API
</dd>
<dt>Pandoc</dt>
<dd>
Run in server mode is a powerful template engine
</dd>
<dt>Newt</dt>
<dd>
Is a data router and static file server. Newt knows how to talk to a
data source like PostgREST or Solr and then run the results through
Pandoc.
</dd>
</dl>
<p>The “coding” of the back-end is reduced to SQL and Pandoc templates.
The front-end can be as complex as you like given the full capabilities
of your web browser to handle HTML, CSS and JavaScript.</p>
</section>

<footer>
<span><h1><A href="http://caltech.edu">Caltech</a></h1></span>
<span>&copy; 2023 <a href="https://www.library.caltech.edu/copyright">Caltech library</a></span>
<address>1200 E California Blvd, Mail Code 1-32, Pasadena, CA 91125-3200</address> 
<span>Phone: <a href="tel:+1-626-395-3405">(626)395-3405</a></span>
<span><a href="mailto:library@caltech.edu">Email Us</a></span>
<a class="cl-hide" href="sitemap.xml">Site Map</a>
</footer>
</body>
</html>
