<!DOCTYPE html>
<html>
<head>
    <title>Newt -- a new take on the webstack</title>
    <link rel="stylesheet" href="https://caltechlibrary.github.io/css/site.css">
</head>
<body>
<header>
<a href="https://library.caltech.edu"><img src="https://caltechlibrary.github.io/assets/liblogo.gif" alt="Caltech Library logo"></a>
</header>
<nav>
<ul>
	<li><a href="/">Home</a></li>
	<li><a href="./">README</a></li>
	<li><a href="user-manual.html">User Manual</a></li>
	<li><a href="LICENSE">LICENSE</a></li>
	<li><a href="INSTALL.html">INSTALL</a></li>
	<li><a href="about.html">About</a></li>
	<li><a href="https://github.com/caltechlibrary/newt">GitHub</a></li>
</ul>
</nav>

<section>
<h1 id="newt">Newt</h1>
<h2 id="a-small-system-experiment">a small system experiment</h2>
<h3 id="but-first-some-context">… but first some context</h3>
<h1 id="lamp-and-the-stacks-of-complexity">LAMP and the stacks of
complexity</h1>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Software</th>
<th style="text-align: left;">Stack</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EPrints</td>
<td style="text-align: left;">Clasic LAMP + Xapian</td>
</tr>
<tr class="even">
<td style="text-align: left;">Islandora</td>
<td style="text-align: left;">Apache+MySQL+PHP, Fedora and Solr</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ArchivesSpace</td>
<td style="text-align: left;">Apache, MySQL, Tomcat, Java+jRuby,</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Solr</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Invenio RDM</td>
<td style="text-align: left;">NginX, Python/pip, Postgres, Redis,</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Elasticsearch, Docker, NodeJS/NPM</td>
</tr>
</tbody>
</table>
<h1 id="our-legacy-of-complexity">our Legacy of Complexity</h1>
<ol type="1">
<li>Applications are built on a stack</li>
<li>Stacks are complex and divergent</li>
<li>Sustaining them requires many coping strategies</li>
</ol>
<h1 id="the-problem">the Problem</h1>
<ul>
<li>Our coping strategies are not sustainable</li>
<li>Complexity is part of the problem</li>
</ul>
<h1 id="why-are-these-things-so-complex">Why are these things so
complex?</h1>
<ol type="1">
<li>We want more from our application, more code gets written</li>
<li>We want “enhancements”, complexity accrues overtime</li>
<li>We build “systems designed to scale”</li>
</ol>
<h1 id="scaling">Scaling</h1>
<dl>
<dt>scale</dt>
<dd>
a euphemism for <strong>scaling big</strong>, usage “google scale”,
“amazon scale”
</dd>
</dl>
<ul>
<li>Scaling big is hard</li>
<li>Scaling big can make things really complex</li>
</ul>
<h1 id="scaling-1">Scaling</h1>
<ul>
<li>Scaling big shows us a path to scaling small
<ul>
<li><strong>Can we pack only what is needed?</strong></li>
</ul></li>
</ul>
<h1 id="scaling-strategies">Scaling strategies</h1>
<ul>
<li>distributed application design</li>
<li>containers</li>
<li>programmable infrastructure</li>
</ul>
<h1 id="scaling-small">Scaling small</h1>
<ul>
<li>Limit the moving parts</li>
<li>Limit the cognitive shifts</li>
<li>Try to <strong>Write less code</strong></li>
</ul>
<h1 id="limit-the-moving-parts-three-abstractions">Limit the moving
parts, three abstractions</h1>
<ul>
<li>JSON source to manage data =&gt; <a
href="https://postgresql.org">Postgres</a> + <a
href="https://postgrest.org">PostgREST</a></li>
<li>A powerful template engine =&gt; <a
href="https://pandoc.org">Pandoc</a></li>
<li>data outer, form validator =&gt; <a
href="https://github.com/caltechlibrary/newt/">Newt</a></li>
</ul>
<h1 id="a-microservice-conversation">A microservice conversation</h1>
<ol type="1">
<li>web browser =&gt; Newt</li>
<li>Newt =&gt; PostgREST</li>
<li>Newt =&gt; Pandoc</li>
<li>Newt =&gt; web browser</li>
</ol>
<h1 id="limit-the-cognitive-shifts">Limit the cognitive shifts</h1>
<ul>
<li>Write SQL (Postgres), get JSON source (PostgREST)</li>
<li>Write Pandoc templates, use JSON, get HTML</li>
<li>Write YAML, orchestrate our microservice conversation</li>
</ul>
<h1 id="writing-less-code">Writing less code</h1>
<ol type="1">
<li>Use “off the shelf” microservices</li>
<li>Take advantage of SQL</li>
<li>Standardize templating with Pandoc</li>
</ol>
<blockquote>
<p><strong>Got middle-ware?</strong> Postgres+PostgREST+Pandoc+Newt</p>
</blockquote>
<h1 id="why-sql">Why SQL?</h1>
<ul>
<li>SQL is good at describing structured data</li>
<li>SQL provides views, functions, triggers, …</li>
<li>SQL allows us to model our data once</li>
</ul>
<blockquote>
<p><strong>Minimize the source Luke!</strong> PostgreSQL+PostgREST is a
code savings plan.</p>
</blockquote>
<h1 id="a-scale-small-experiment">A scale small experiment</h1>
<p>Let’s compare three implementations of a bird sighting website</p>
<h1 id="birds-1"><a
href="https://raw.githubusercontent.com/caltechlibrary/newt/main/demos/make-birds1.bash"
title="this is a static website">birds 1</a></h1>
<p>CSV file, Pandoc, 2 directories, 5 files, 53 total line count, static
site hosting</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Lines</th>
<th style="text-align: left;">Files</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds1/README.html">README.md</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds1/birds.csv">birds.csv</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds1/build.sh">build.sh</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds1/page.tmpl">page.tmpl</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">38</td>
<td style="text-align: left;">htdocs/index.html</td>
</tr>
</tbody>
</table>
<p>See <a
href="https://caltechlibrary.github.io/newt/demos/birds1/htdocs/index.html"
class="uri">https://caltechlibrary.github.io/newt/demos/birds1/htdocs/index.html</a></p>
<h1 id="birds-2"><a
href="https://raw.githubusercontent.com/caltechlibrary/newt/main/demos/make-birds2.bash"
title="this website requires a machine">birds 2</a></h1>
<p>SQL (Postgres + PostgREST), Browser JavaScript, 2 directories, 6
files, 177 total line count, dynamic site requires hosting</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Lines</th>
<th style="text-align: left;">Files</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">33</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds2/README.html">README.md</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds2/birds.csv">birds.csv</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">50</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds2/setup.sql">setup.sql</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds2/postgrest.conf">postgrest.conf</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">63</td>
<td style="text-align: left;">htdocs/<a
href="https://caltechlibrary.github.io/newt/demos/birds2/htdocs/sightings.js">sightings.js</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">24</td>
<td style="text-align: left;">htdocs/index.html</td>
</tr>
</tbody>
</table>
<h1 id="birds-3"><a
href="https://raw.githubusercontent.com/caltechlibrary/newt/main/demos/make-birds3.bash"
title="this website requires a machine">birds 3</a></h1>
<p>SQL (Postgres + PostgREST), Pandoc, Newt, 1 directory, 7 files, 162
total line count, dynamic site requires hosting, <strong>no JavaScript
required</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Lines</th>
<th style="text-align: left;">Files</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">33</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds3/README.html">README.md</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">birds.csv</td>
</tr>
<tr class="odd">
<td style="text-align: left;">50</td>
<td style="text-align: left;">setup.sql</td>
</tr>
<tr class="even">
<td style="text-align: left;">25</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds3/birds.yaml">birds.yaml</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">40</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds3/page.tmpl">page.tmpl</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: left;"><a
href="https://caltechlibrary.github.io/newt/demos/birds3/post_result.tmpl">post_result.tmpl</a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">postgrest.conf</td>
</tr>
</tbody>
</table>
<h1 id="newts-yaml-file">Newt’s YAML file</h1>
<ul>
<li>environment variable used to access JSON sources</li>
<li>route definitions
<ul>
<li>(optional) variable definitions (path and form data)</li>
<li>request routing details (e.g. path, method)</li>
<li>JSON source details (e.g. api URL, method, content type)</li>
<li>(optional) Pandoc template filename</li>
</ul></li>
</ul>
<p>See <a
href="https://raw.githubusercontent.com/caltechlibrary/newt/main/demos/birds3/birds.yaml"
class="uri">https://raw.githubusercontent.com/caltechlibrary/newt/main/demos/birds3/birds.yaml</a></p>
<h1 id="developer-workflow">Developer workflow</h1>
<ol type="1">
<li>Model data in Postgres</li>
<li>Create/update Pandoc templates</li>
<li>Create/update routes/form data validation in YAML file</li>
<li>(Re)start PostgREST and Newt to (re)load models and routes</li>
<li>Test with our web browser</li>
</ol>
<p><strong>Repeat as needed</strong></p>
<h1 id="recap">Recap</h1>
<table>
<thead>
<tr class="header">
<th>version</th>
<th>site type</th>
<th style="text-align: left;">pros</th>
<th style="text-align: left;">cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>birds 1</td>
<td>static</td>
<td style="text-align: left;">easy to conceptualize,</td>
<td style="text-align: left;">read only</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td style="text-align: left;">no JavaScript required</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td>birds 2</td>
<td>dynamic</td>
<td style="text-align: left;">read/write data</td>
<td style="text-align: left;">requires SQL knowledge</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">requires browser JavaScript</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">JavaScript is complex</td>
</tr>
<tr class="even">
<td>birds 3</td>
<td>dynamic</td>
<td style="text-align: left;">read/write data</td>
<td style="text-align: left;">requires SQL knowledge</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td style="text-align: left;">easy to conceptualize</td>
<td style="text-align: left;">requires knowledge of Pandoc</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td style="text-align: left;">no JavaScript required</td>
<td style="text-align: left;">requires knowledge of YAML</td>
</tr>
</tbody>
</table>
<h1 id="weaknesses-in-my-proposal">Weaknesses in my proposal</h1>
<ul>
<li>Newt is <strong>an experimental prototype</strong> (June/July
2023)</li>
<li>Newt doesn’t support file uploads</li>
<li>Newt doesn’t eliminate learning curves, e.g. Postgres and SQL;
Pandoc; using HTTP methods; YAML</li>
</ul>
<h1 id="newts-greatest-advantage">Newt’s greatest advantage</h1>
<blockquote>
<p>A mature foundation</p>
</blockquote>
<ul>
<li>20th Century tech
<ul>
<li>SQL (1974), HTTP (1991), HTML (1993), Postgres (1996)</li>
</ul></li>
<li>21st Century tech
<ul>
<li>JSON (2001), YAML (2001), Pandoc (2006), PostgREST (2014)</li>
</ul></li>
</ul>
<h1 id="an-unexpected-result">An unexpected result</h1>
<blockquote>
<p>Newt can potentially scale big!</p>
</blockquote>
<ul>
<li>Newt can be scaled wide (not stateful)</li>
<li>Pandoc server can be scaled wide (not stateful)</li>
<li>PostgREST can be scale wide (not stateful)</li>
<li>Postgres can be clustered (stateful)</li>
</ul>
<h1 id="next-steps-for-newt">Next steps for Newt?</h1>
<ul>
<li>Testing Solr/Elasticsearch as alternate JSON sources</li>
<li>I am building staff facing applications this Summer (2023)</li>
<li>I hope to move beyond my proof of concept in Fall/Winter (2023)</li>
</ul>
<h1 id="sameday-maybe">Sameday, maybe …</h1>
<ul>
<li>Have Newt delegate file uploads to an S3 like service</li>
<li>Enhance the Newt’s YAML to generate SQL models</li>
<li>Explore integrating SQLite3 support</li>
</ul>
<h1 id="if-newt-had-a-community">If Newt had a community …</h1>
<ul>
<li>share SQL code</li>
<li>share Pandoc templates</li>
<li>share YAML files</li>
<li>improve Newt</li>
</ul>
<h1 id="conclusions">Conclusions</h1>
<ul>
<li>“Off the shelf” microservices can make application construction
easier</li>
<li>Orchestrating the data pipeline in YAML seems reasonable</li>
<li>SQL may turn some people off</li>
<li>Pandoc templates are simple to learn and avoid embedding business
logic</li>
<li>You still have all the HTML5 goodness available in the
front-end</li>
</ul>
<h1 id="additional-resources">Additional resources</h1>
<ul>
<li><a href="https://github.com/caltechlibrary/newt">Newt</a></li>
<li><a href="https://postgres.org">Postgres</a> + <a
href="https://postgrest.org">PostgREST</a>
<ul>
<li><a href="https://postgrest.org/en/stable/ecosystem.html">PostgREST
Community Tutorials</a></li>
</ul></li>
<li>Compiling Pandoc or PostgREST requires Haskell
<ul>
<li>Install Haskell <a
href="https://https://www.haskell.org/ghcup/">ghcup</a></li>
</ul></li>
</ul>
<h1 id="thank-you">Thank you!</h1>
<ul>
<li>This Presentation <a
href="https://caltechlibrary.github.io/newt/presentation/"
class="uri">https://caltechlibrary.github.io/newt/presentation/</a></li>
<li>Project: <a href="https://github.com/caltechlibrary/newt"
class="uri">https://github.com/caltechlibrary/newt</a></li>
<li>Email: rsdoiel@caltech.edu</li>
</ul>
</section>

<footer>
<span><h1><A href="http://caltech.edu">Caltech</a></h1></span>
<span>&copy; 2023 <a href="https://www.library.caltech.edu/copyright">Caltech library</a></span>
<address>1200 E California Blvd, Mail Code 1-32, Pasadena, CA 91125-3200</address> 
<span>Phone: <a href="tel:+1-626-395-3405">(626)395-3405</a></span>
<span><a href="mailto:library@caltech.edu">Email Us</a></span>
<a class="cl-hide" href="sitemap.xml">Site Map</a>
</footer>
</body>
</html>
