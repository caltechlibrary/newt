<!DOCTYPE html>
<html>
<head>
    <title>Newt -- a new take on the webstack</title>
    <link rel="stylesheet" href="https://caltechlibrary.github.io/css/site.css">
</head>
<body>
<header>
<a href="https://library.caltech.edu"><img src="https://caltechlibrary.github.io/assets/liblogo.gif" alt="Caltech Library logo"></a>
</header>
<nav>
<ul>
	<li><a href="/">Home</a></li>
	<li><a href="./">README</a></li>
	<li><a href="user-manual.html">User Manual</a></li>
	<li><a href="LICENSE">LICENSE</a></li>
	<li><a href="INSTALL.html">INSTALL</a></li>
	<li><a href="about.html">About</a></li>
	<li><a href="https://github.com/caltechlibrary/newt">GitHub</a></li>
</ul>
</nav>

<section>
<h1 id="scaling">Scaling</h1>
<dl>
<dt>scale</dt>
<dd>
euphemism for <strong>high availability, high demand</strong>. Usage
“google scale”, “amazon scale”.
</dd>
</dl>
<blockquote>
<p>Scaling big is not the only way to scale.</p>
</blockquote>
<h1 id="scaling-small">Scaling small</h1>
<ul>
<li>Pick a few microservices</li>
<li>System composition via configuration</li>
</ul>
<h1 id="three-abstractions">Three abstractions</h1>
<ul>
<li>A Template engine =&gt; <a href="https://pandoc.org">Pandoc</a></li>
<li>A JSON source to manage data =&gt; <a
href="https://postgresql.org">Postgres</a> + <a
href="https://postgrest.org">PostgREST</a></li>
<li>A data router, form validator =&gt; <a
href="https://github.com/caltechlibrary/newt/">Newt</a></li>
</ul>
<h1 id="cognitive-shifts">Cognitive shifts</h1>
<ul>
<li>Use templates to generate HTML (Pandoc)</li>
<li>Model in SQL (Postgres) get JSON (PostgREST)</li>
<li>Orchestrate our microservice conversation with YAML (Newt)</li>
</ul>
<h1 id="why-sql">Why SQL?</h1>
<ul>
<li>Good at describing structured data</li>
<li>Supports queries, views, functions, triggers, events, …</li>
<li>Allows us to model our data once</li>
<li>PostgREST gives us a JSON api based on the SQL we write</li>
</ul>
<blockquote>
<p><strong>Minimize the source Luke!</strong></p>
</blockquote>
<blockquote>
<p>PostgreSQL+PostgREST, a code savings plan</p>
</blockquote>
<h1 id="a-scale-small-experiment">A scale small experiment</h1>
<p>Let’s compare three implementations of a bird sighting website</p>
<h1 id="birds-1"><a href="../demos/make-birds1.bash"
title="this is a static website">birds 1</a></h1>
<p>CSV file, Pandoc, 2 directories, 5 files, <strong>72 total line
count</strong>, static site hosting. Included is a typical setup I would
use for a static site project.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Lines</th>
<th style="text-align: left;">Files</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">21</td>
<td style="text-align: left;"><a
href="../demos/birds1/README.html">README.md</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">birds.csv</td>
</tr>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">build.sh</td>
</tr>
<tr class="even">
<td style="text-align: left;">7</td>
<td style="text-align: left;">page.tmpl</td>
</tr>
<tr class="odd">
<td style="text-align: left;">32</td>
<td style="text-align: left;">htdocs/index.html</td>
</tr>
</tbody>
</table>
<p>See <a
href="https://github.com/caltechlibrary/newt/tree/main/demos/birds1"
class="uri">https://github.com/caltechlibrary/newt/tree/main/demos/birds1</a></p>
<h1 id="birds-2"><a href="../demos/make-birds2.bash"
title="this website requires a machine">birds 2</a></h1>
<p>SQL (Postgres + PostgREST), Browser JavaScript, 2 directories, 8
files, <strong>232 total line count</strong>, dynamic site requires
hosting</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Lines</th>
<th style="text-align: left;">Files</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">29</td>
<td style="text-align: left;"><a
href="../demos/birds2/README.html">README.md</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">birds.csv</td>
</tr>
<tr class="odd">
<td style="text-align: left;">34</td>
<td style="text-align: left;">setup.sql</td>
</tr>
<tr class="even">
<td style="text-align: left;">60</td>
<td style="text-align: left;">models.sql</td>
</tr>
<tr class="odd">
<td style="text-align: left;">15</td>
<td style="text-align: left;">models_test.sql</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">postgrest.conf</td>
</tr>
<tr class="odd">
<td style="text-align: left;">24</td>
<td style="text-align: left;">htdocs/index.html</td>
</tr>
<tr class="even">
<td style="text-align: left;">63</td>
<td style="text-align: left;">htdocs/sightings.js</td>
</tr>
</tbody>
</table>
<p>See <a
href="https://github.com/caltechlibrary/newt/tree/main/demos/birds2"
class="uri">https://github.com/caltechlibrary/newt/tree/main/demos/birds2</a></p>
<h1 id="birds-3"><a href="../demos/make-birds3.bash"
title="this website requires a machine">birds 3</a></h1>
<p>SQL (Postgres + PostgREST), Pandoc, Newt, 1 directory, 7 files, 277
total line count, dynamic site requires hosting, <strong>no JavaScript
required</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Lines</th>
<th style="text-align: left;">Files</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">43</td>
<td style="text-align: left;"><a
href="../demos/birds3/README.html">README.md</a></td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">birds.csv</td>
</tr>
<tr class="odd">
<td style="text-align: left;">34</td>
<td style="text-align: left;">setup.sql</td>
</tr>
<tr class="even">
<td style="text-align: left;">60</td>
<td style="text-align: left;">models.sql</td>
</tr>
<tr class="odd">
<td style="text-align: left;">15</td>
<td style="text-align: left;">models_test.sql</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">postgrest.conf</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25</td>
<td style="text-align: left;">birds.yaml</td>
</tr>
<tr class="even">
<td style="text-align: left;">36</td>
<td style="text-align: left;">page.tmpl</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">post_result.tmpl</td>
</tr>
</tbody>
</table>
<p>See <a
href="https://github.com/caltechlibrary/newt/tree/main/demos/birds3"
class="uri">https://github.com/caltechlibrary/newt/tree/main/demos/birds3</a></p>
<h1 id="newts-microservice-conversation">Newt’s microservice
conversation</h1>
<ol type="1">
<li>web browser =&gt; Newt</li>
<li>Newt =&gt; PostgREST</li>
<li>Newt =&gt; Pandoc</li>
<li>Newt =&gt; web browser</li>
</ol>
<h1 id="newts-yaml-file">Newt’s YAML file</h1>
<ul>
<li>htdocs directory for static content (option)</li>
<li>environment variable used to access JSON sources (optional)</li>
<li>models (optional, used to bootstrap SQL code)</li>
<li>route definitions
<ul>
<li>(optional) variable definitions (path and form data)</li>
<li>request routing details (e.g. path, method)</li>
<li>JSON source details (e.g. API URL, method, content type)</li>
<li>(optional) Pandoc template filename</li>
</ul></li>
</ul>
<p>See <a
href="https://raw.githubusercontent.com/caltechlibrary/newt/main/demos/birds3/birds.yaml"
class="uri">https://raw.githubusercontent.com/caltechlibrary/newt/main/demos/birds3/birds.yaml</a></p>
<h1 id="developer-workflow">Developer workflow</h1>
<ol type="1">
<li>Define models/routes/form validation in Newt YAML file</li>
<li>Enhance models in SQL and Postgres</li>
<li>Create/update Pandoc templates</li>
<li>(Re)start PostgREST and Newt to (re)load models and routes</li>
<li>Test with our web browser</li>
</ol>
<p><strong>Repeat as needed</strong></p>
<h1 id="newt-stack-weakness">Newt stack weakness</h1>
<ul>
<li>Newt is <strong>an experimental prototype</strong> (June/July
2023)</li>
<li>Newt’s generated SQL presumes customization by developer</li>
<li>Newt doesn’t support file uploads</li>
<li>Newt doesn’t eliminate learning curves, e.g. Postgres and SQL;
Pandoc; using HTTP methods; YAML</li>
</ul>
<h1 id="newt-stack-strengths">Newt stack strengths</h1>
<blockquote>
<p>A mature foundation</p>
</blockquote>
<ul>
<li>20th Century tech
<ul>
<li>SQL (1974), HTTP (1991), HTML (1993), Postgres (1996)</li>
</ul></li>
<li>21st Century tech
<ul>
<li>JSON (2001), YAML (2001), Pandoc (2006), PostgREST (2014)</li>
</ul></li>
</ul>
<h1 id="experimental-insights-so-far">Experimental insights so far</h1>
<ul>
<li>“Off the shelf” microservices can make application construction
easier</li>
<li>Orchestrating the data pipeline in YAML seems reasonable</li>
<li>SQL turns some people off, Newt may help mitigate that</li>
<li>Pandoc templates are simple to learn</li>
<li>Newt stack plays well with HTML5 approaches and best practices</li>
</ul>
<h1 id="an-unexpected-result">An unexpected result</h1>
<blockquote>
<p>Newt stack can scale big</p>
</blockquote>
<ul>
<li>Newt maintains very little “state”</li>
<li>Pandoc server requires no “state”</li>
<li>PostgREST maintains very little “state</li>
<li>Postgres can be clustered</li>
</ul>
<h1 id="next-steps-for-newt">Next steps for Newt?</h1>
<ol type="1">
<li>Enhance SQL generation</li>
<li>Test with Solr/Elasticsearch as alternate JSON sources</li>
<li>Build staff facing applications this Summer (2023)</li>
<li>Hopefully move beyond my proof of concept in Winter (2023), Spring
(2024)</li>
</ol>
<h1 id="someday-maybe">Someday, maybe …</h1>
<ul>
<li>Have Newt delegate file uploads to an S3 like service</li>
<li>Explore integrating SQLite3 support in addition to
Postgres+PostgREST</li>
<li>A Newt community to share YAML, SQL and Pandoc templates</li>
</ul>
<h1 id="additional-resources">Additional resources</h1>
<ul>
<li>Newt <a href="https://github.com/caltechlibrary/newt"
class="uri">https://github.com/caltechlibrary/newt</a></li>
<li>Postgres <a href="https://postgres.org"
class="uri">https://postgres.org</a> + PostgREST <a
href="https://postgrest.org" class="uri">https://postgrest.org</a>
<ul>
<li>PostgREST Community Tutorials <a
href="https://postgrest.org/en/stable/ecosystem.html"
class="uri">https://postgrest.org/en/stable/ecosystem.html</a></li>
</ul></li>
<li>Compiling Pandoc or PostgREST requires Haskell
<ul>
<li>Install Haskell GHCup <a
href="https://https://www.haskell.org/ghcup/"
class="uri">https://https://www.haskell.org/ghcup/</a></li>
</ul></li>
</ul>
<h1 id="thank-you">Thank you!</h1>
<ul>
<li>This Presentation <a
href="https://caltechlibrary.github.io/newt/presentation/"
class="uri">https://caltechlibrary.github.io/newt/presentation/</a></li>
<li>Project: <a href="https://github.com/caltechlibrary/newt"
class="uri">https://github.com/caltechlibrary/newt</a></li>
<li>Email: rsdoiel@caltech.edu</li>
</ul>
</section>

<footer>
<span><h1><A href="http://caltech.edu">Caltech</a></h1></span>
<span>&copy; 2023 <a href="https://www.library.caltech.edu/copyright">Caltech library</a></span>
<address>1200 E California Blvd, Mail Code 1-32, Pasadena, CA 91125-3200</address> 
<span>Phone: <a href="tel:+1-626-395-3405">(626)395-3405</a></span>
<span><a href="mailto:library@caltech.edu">Email Us</a></span>
<a class="cl-hide" href="sitemap.xml">Site Map</a>
</footer>
</body>
</html>
