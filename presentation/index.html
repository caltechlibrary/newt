<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="R. S. Doiel, rsdoiel@caltech.edu" />
  <meta name="date" content="2023-07-14" />
  <meta name="keywords" content="code4lib, meetup, Postgres, webstack, PostgREST, Pandoc" />
  <title>Newt, assemble web applications with Pandoc, Postgres and PostgREST</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">Newt, assemble web applications with Pandoc,
Postgres and PostgREST</h1>
  <p class="author">
R. S. Doiel, <a href="mailto:rsdoiel@caltech.edu"
class="email">rsdoiel@caltech.edu</a>
  </p>
  <p class="institute">
<p>Caltech Library, Digital Library Development</p>
  </p>
  <p class="date">July 14, 2023</p>
</div>
<div class="slide" id="TOC">

</div>
<div id="newt" class="slide section level1">
<h1>Newt</h1>
<h2 id="a-small-system-experiment">a small system experiment</h2>
<h3 id="but-first-some-context">… but first some context</h3>
</div>
<div id="lamp-and-its-legacy" class="slide section level1">
<h1>LAMP and its legacy</h1>
<p>Complex systems used by Caltech Library</p>
<ul>
<li>ArchivesSpace</li>
<li>EPrints</li>
<li>Invenio RDM</li>
<li>Islandora</li>
</ul>
</div>
<div id="lamp-and-its-legacy-1" class="slide section level1">
<h1>LAMP and its legacy</h1>
<table>
<thead>
<tr class="header">
<th align="left">App</th>
<th>Languages</th>
<th>Supporting services</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ArchivesSpace</td>
<td>Java, Ruby, SQL</td>
<td>MySQL, Solr, Apache or NginX</td>
</tr>
<tr class="even">
<td align="left">EPrints</td>
<td>Perl, SQL, XML,</td>
<td>MySQL, Apache2 (tight integration),</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>EPrints XML</td>
<td>and Xapian</td>
</tr>
<tr class="even">
<td align="left">Invenio RDM</td>
<td>Python, SQL</td>
<td>Postgres, Redis, Elasticsearch,</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td>JavaScript</td>
<td>Docker, Invenio Framework,</td>
</tr>
<tr class="even">
<td align="left"></td>
<td></td>
<td>Python packaging system,</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td></td>
<td>React JavaScript framework,</td>
</tr>
<tr class="even">
<td align="left"></td>
<td></td>
<td>NodeJS and NPM, NginX</td>
</tr>
<tr class="odd">
<td align="left">Islandora</td>
<td>PHP/SQL</td>
<td>MySQL, Drupal, Fedora, Apache 2</td>
</tr>
</tbody>
</table>
</div>
<div id="the-problem" class="slide section level1">
<h1>The problem</h1>
<ol style="list-style-type: decimal">
<li>Each application was built on a stack</li>
<li>The stacks are complex and divergent</li>
<li>Sustaining them requires many coping strategies</li>
</ol>
</div>
<div id="the-problem-1" class="slide section level1">
<h1>The problem</h1>
<ul>
<li>Our coping strategies are not sustainable</li>
<li>Complexity is part of the problem</li>
</ul>
</div>
<div id="why-are-these-things-so-complex" class="slide section level1">
<h1>Why are these things so complex?</h1>
<ul>
<li>We want more from our application, more code gets written</li>
<li>We want “enhancements”, complexity accrues overtime</li>
<li>Best Practices like “systems should be designed to scale”</li>
</ul>
</div>
<div id="why-are-these-things-so-complex-1"
class="slide section level1">
<h1>Why are these things so complex?</h1>
<ul>
<li>first two are “people problems” (hard)</li>
<li>last one might be a system design problem (solvable?)</li>
</ul>
</div>
<div id="scale-from-computing-practice" class="slide section level1">
<h1>Scale (from computing practice)</h1>
<dl>
<dt>scale</dt>
<dd>
a euphemism for <strong>scaling big</strong>, as used in phrases like
“google scale”, “amazon scale”
</dd>
</dl>
</div>
<div id="scaling-big" class="slide section level1">
<h1>Scaling big</h1>
<ul>
<li>Scaling big is hard</li>
<li>Scaling big can make things really complex</li>
<li>Scaling big can require larger teams for success</li>
</ul>
</div>
<div id="scaling-big-1" class="slide section level1">
<h1>Scaling big</h1>
<ul>
<li>What did scaling big deliver?
<ul>
<li>distributed application design</li>
<li>containers</li>
<li>programmable infrastructure</li>
<li>cache systems and dynamic clustering</li>
<li>complex systems management</li>
</ul></li>
</ul>
</div>
<div id="scaling-from-geometry" class="slide section level1">
<h1>Scaling (from geometry)</h1>
<dl>
<dt>scaling</dt>
<dd>
a linear transformation that enlarges or diminishes objects
</dd>
</dl>
</div>
<div id="may-i-suggests-scale-small" class="slide section level1">
<h1>May I suggests? <strong>scale small</strong></h1>
<ul>
<li>Pack only what is needed</li>
<li>Simplify!</li>
</ul>
</div>
<div id="scaling-small" class="slide section level1">
<h1>Scaling small</h1>
<ul>
<li>Limit the moving parts</li>
<li>Limit the cognitive shifts</li>
<li>Minimize the toolbox, maximize using it</li>
<li>Try to <strong>Write less code!</strong></li>
</ul>
</div>
<div id="limit-the-moving-parts" class="slide section level1">
<h1>Limit the moving parts</h1>
<blockquote>
<p>Simplify through a clear division of labor</p>
</blockquote>
<ul>
<li><a href="https://postgresql.org">Postgres</a> + <a
href="https://postgrest.org">PostgREST</a> =&gt; JSON API to manage
data, it gives us a JSON source</li>
<li><a href="https://pandoc.org">Pandoc</a> =&gt; a powerful template
engine</li>
<li><a href="https://github.com/caltechlibrary/newt/">Newt</a> =&gt;
data router, form data validator, static file services</li>
</ul>
</div>
<div id="limit-the-moving-parts-1" class="slide section level1">
<h1>Limit the moving parts</h1>
<ol style="list-style-type: decimal">
<li>web browser =&gt; Newt</li>
<li>Newt =&gt; PostgREST</li>
<li>Newt =&gt; Pandoc</li>
<li>Newt =&gt; web browser</li>
</ol>
</div>
<div id="limit-the-cognitive-shifts-client-side"
class="slide section level1">
<h1>Limit the cognitive shifts, client side</h1>
<blockquote>
<p>The status quo presists on the front-end</p>
</blockquote>
<ul>
<li>HTML, CSS, JavaScript, image assets, etc.</li>
</ul>
</div>
<div id="limit-the-cognitive-shifts-server-side"
class="slide section level1">
<h1>Limit the cognitive shifts, server side</h1>
<ul>
<li>SQL</li>
<li>Pandoc templates</li>
<li>Our YAML orchestration file</li>
</ul>
</div>
<div id="limit-the-cognitive-shifts-why-emphasize-sql"
class="slide section level1">
<h1>Limit the cognitive shifts, why emphasize SQL?</h1>
<ul>
<li>SQL is good at describing structured data</li>
<li>SQL is good at expressing queries</li>
<li>SQL provides rich data types</li>
<li>SQL can define data views, functions, procedures, triggers, …</li>
</ul>
</div>
<div id="write-less-code" class="slide section level1">
<h1>Write less code</h1>
<blockquote>
<p>PostgreSQL+PostgREST is my code saving plan</p>
</blockquote>
<ul>
<li>The SQL runtime is rich in capability</li>
<li>Don’t need to learn an ORM, we’re not limited by an ORM</li>
<li>Don’t duplicate the SQL models in another language</li>
<li>Don’t write any middle-ware</li>
</ul>
<blockquote>
<p>Minimize the source Luke!</p>
</blockquote>
</div>
<div id="minimized-toolbox-maximize-using-it"
class="slide section level1">
<h1>Minimized Toolbox, maximize using it</h1>
<ul>
<li>Text editor</li>
<li>Postgres + PostgREST</li>
<li>Pandoc</li>
<li>Newt</li>
<li>Web browser</li>
</ul>
</div>
<div id="three-cognitive-shifts" class="slide section level1">
<h1>Three cognitive shifts</h1>
<ul>
<li>Write SQL (Postgres) and get a JSON source (PostgREST)</li>
<li>Write Pandoc templates to transform JSON to HTML</li>
<li>Write a YAML file to orchestrate our microservice conversation</li>
</ul>
</div>
<div id="is-this-really-simpler" class="slide section level1">
<h1>Is this really simpler?</h1>
<p>Three versions of a bird sighting website</p>
</div>
<div id="birds-1" class="slide section level1">
<h1><a
href="https://raw.githubusercontent.com/caltechlibrary/newt/main/demos/make-birds1.bash">birds
1</a></h1>
<ul>
<li>Built with Pandoc from a CSV file and a Pandoc template</li>
</ul>
<pre><code>2 directories, 5 files
       5 birds1/README.md
       4 birds1/birds.csv
       3 birds1/build.sh
      13 birds1/page.tmpl
      38 birds1/htdocs/index.html
      63 total</code></pre>
</div>
<div id="birds-2" class="slide section level1">
<h1><a
href="https://raw.githubusercontent.com/caltechlibrary/newt/main/demos/make-birds2.bash">birds
2</a></h1>
<ul>
<li>Built with SQL (Postgres + PostgREST), Browser side JavaScript</li>
</ul>
<pre><code>2 directories, 6 files
   4 birds2/birds.csv
   3 birds2/postgrest.conf
  32 birds2/README.md
  50 birds2/setup.sql
  24 birds2/htdocs/index.html
  63 birds2/htdocs/sightings.js
 176 total</code></pre>
</div>
<div id="birds-3" class="slide section level1">
<h1><a
href="https://raw.githubusercontent.com/caltechlibrary/newt/main/demos/make-birds3.bash">birds
3</a></h1>
<ul>
<li>Built with SQL (Postgres + PostgREST), Pandoc, Newt</li>
<li><strong>no JavaScript</strong></li>
</ul>
<pre><code>1 directory, 7 files
   4 birds3/birds.csv
  25 birds3/birds.yaml
  40 birds3/page.tmpl
   3 birds3/postgrest.conf
   7 birds3/post_result.tmpl
  33 birds3/README.md
  50 birds3/setup.sql
 162 total</code></pre>
</div>
<div id="comparing-three-birds" class="slide section level1">
<h1>Comparing three birds</h1>
<table>
<thead>
<tr class="header">
<th>version</th>
<th>site type</th>
<th align="left">pros</th>
<th align="left">cons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>birds 1</td>
<td>static</td>
<td align="left">easy to conceptualize,</td>
<td align="left">read only</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td align="left">no JavaScript required</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td>birds 2</td>
<td>dynamic</td>
<td align="left">read/write data</td>
<td align="left">requires SQL knowledge</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td align="left"></td>
<td align="left">requires browser JavaScript</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td align="left"></td>
<td align="left">JavaScript is complex</td>
</tr>
<tr class="even">
<td>birds 3</td>
<td>dynamic</td>
<td align="left">read/write data</td>
<td align="left">requires SQL knowledge</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td align="left">easy to conceptualize,</td>
<td align="left">requires knowledge of Pandoc</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td align="left">no JavaScript required</td>
<td align="left">requires knowledge of YAML</td>
</tr>
</tbody>
</table>
</div>
<div id="bird-3-build-features" class="slide section level1">
<h1>Bird 3 build features</h1>
<ol style="list-style-type: decimal">
<li>Model our data using SQL (Postgres)</li>
<li>Access via JSON API (PostgREST)</li>
<li>Transform our structured data using Pandoc templates (Pandoc
server)</li>
<li>Orchestrate our microservice conversation via YAML file (Newt)</li>
</ol>
</div>
<div id="how-does-newt-orchestrate-our-microservices"
class="slide section level1">
<h1>How does Newt orchestrate our microservices?</h1>
<ul>
<li>Newt’s YAML file includes descriptions for request routing
<ul>
<li>htdocs directory (if serving static files)</li>
<li>environment variable used to access JSON sources</li>
<li>route definitions
<ul>
<li>(optional) variable definitions</li>
<li>request routing details (e.g. path, method)</li>
<li>JSON source description (e.g. api URL, method, content type)</li>
<li>(optional) Pandoc template filename</li>
</ul></li>
<li>port number (for Newt)</li>
</ul></li>
</ul>
</div>
<div id="newt-manages-data-flow" class="slide section level1">
<h1>Newt manages data flow</h1>
<ol style="list-style-type: decimal">
<li>web browser =&gt; Newt</li>
<li>Newt =&gt; PostgREST</li>
<li>Newt =&gt; Pandoc</li>
<li>Newt =&gt; web browser</li>
</ol>
</div>
<div id="developer-workflow" class="slide section level1">
<h1>Developer workflow</h1>
<ol style="list-style-type: decimal">
<li>Model data in Postgres (using psql and a text editor)</li>
<li>Create/update Pandoc templates (using a text editor and Pandoc)</li>
<li>Create/update routes/form data validation in YAML file (text editor,
<code>newt -dry-run &lt;YAML_FILENAME&gt;</code>)</li>
<li>(Re)start PostgREST and Newt to (re)load models and routes</li>
<li>Test with our web browser</li>
</ol>
<p><strong>Repeat as needed</strong></p>
</div>
<div id="minimal-prior-knowledge" class="slide section level1">
<h1>Minimal prior knowledge</h1>
<ul>
<li>A data science workshop often will teach you enough SQL</li>
<li>Static website generation often envolves Pandoc</li>
<li>Markdown documents often use YAML to represent front matter</li>
</ul>
</div>
<div id="weaknesses-in-my-proposal" class="slide section level1">
<h1>Weaknesses in my proposal</h1>
<ul>
<li>Newt is <strong>an experimental prototype</strong> (June 2023)</li>
<li>Newt doesn’t support file uploads</li>
<li>Newt doesn’t eliminate Learning curves, e.g.
<ol style="list-style-type: decimal">
<li>Postgres and SQL</li>
<li>Pandoc</li>
<li>using HTTP methods</li>
<li>YAML</li>
</ol></li>
</ul>
</div>
<div id="newts-advantages-a-mature-foundation"
class="slide section level1">
<h1>Newt’s Advantages, a mature foundation</h1>
<ul>
<li>20th Century tech
<ul>
<li>SQL (1974), HTTP (1991), HTML (1993), Postgres (1996)</li>
</ul></li>
<li>21st Century tech
<ul>
<li>JSON (2001), YAML (2001), Pandoc (2006), PostgREST (2014)</li>
</ul></li>
</ul>
</div>
<div id="next-steps-for-newt" class="slide section level1">
<h1>Next steps for Newt?</h1>
<ul>
<li>I am building staff facing applications this Summer (2023)</li>
<li>Testing Solr/Elasticsearch as a JSON sources</li>
<li>I hope to move beyond my proof of concept in the Fall (2023)</li>
</ul>
</div>
<div id="it-would-be-nice-if" class="slide section level1">
<h1>It would be nice if …</h1>
<ul>
<li>Newt could delegate file uploads to an S3 like service</li>
<li>Newt had a community
<ul>
<li>sharing SQL code</li>
<li>sharing Pandoc templates</li>
<li>sharing YAML files</li>
<li>Improving Newt</li>
</ul></li>
</ul>
</div>
<div id="posibilities-a-roadmap-beyond-proof-of-concept"
class="slide section level1">
<h1>Posibilities, a roadmap beyond proof of concept</h1>
<ul>
<li>Enhance the Newt’s YAML to generate SQL models and Pandoc
templates</li>
<li>Explore integrating SQLite3 support</li>
<li>Rewrite Newt in Haskell
<ul>
<li>Integrate Pandoc into Newt avoiding an HTTP call</li>
</ul></li>
</ul>
</div>
<div id="an-unexpected-result-of-simplification"
class="slide section level1">
<h1>An unexpected result of simplification</h1>
<blockquote>
<p>Newt can potentially scale really big!</p>
</blockquote>
<ul>
<li>Newt can be scaled wide (parallel), it requires minimal state (only
what’s in the configuration file)</li>
<li>Pandoc server can be scaled wide (it retains zero stat )</li>
<li>PostgREST can be scale wide (a minimal configuration file)</li>
<li>Postgres (the only part holding state) can be clustered</li>
</ul>
</div>
<div id="additional-resources" class="slide section level1">
<h1>Additional resources</h1>
<ul>
<li><a href="https://postgres.org">Postgres</a></li>
<li>Install Haskell <a
href="https://https://www.haskell.org/ghcup/">ghcup</a>
<ul>
<li>Build latest <a href="https://postgrest.org">PostgREST</a></li>
<li>Build latest <a href="https://pandoc.org">Pandoc</a></li>
</ul></li>
<li><a href="https://github.com/caltechlibrary/newt">Newt</a> proof of
concept</li>
<li><a href="https://solr.apache.org/">Solr</a>, <a
href="https://www.opensearch.org/">Opensearch</a></li>
<li>Alternatives to Postgres+PostgREST
<ul>
<li><a href="https://mariadb.com/products/enterprise/">MariaDB</a> + <a
href="https://mariadb.com/kb/en/maxscale/">Maria Max Scale</a></li>
<li><a href="https://dev.mysql.com">MySQL</a> + <a
href="https://blogs.oracle.com/mysql/post/introducing-the-mysql-rest-service">MRS</a></li>
</ul></li>
</ul>
</div>
<div id="thank-you" class="slide section level1">
<h1>Thank you!</h1>
<ul>
<li>This Presentation <a
href="https://caltechlibrary.github.io/newt/presentation/"
class="uri">https://caltechlibrary.github.io/newt/presentation/</a></li>
<li>Project: <a href="https://github.com/caltechlibrary/newt"
class="uri">https://github.com/caltechlibrary/newt</a></li>
<li>Email: rsdoiel@caltech.edu</li>
</ul>
</div>
</body>
</html>
